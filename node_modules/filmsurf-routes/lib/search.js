var RottenTomatoes = require('./rottentomatoes');
var Persistence = require('./persistence');

exports.search = function(params, callback) {
    var query = params.q;
    var page = params.page ? Number(params.page) : 0;
    var items = params.items ? Number(params.items) : 10;
    var live = params.live && params.live.toLowerCase() === 'true';

    if (query) {
        if (live) {
            RottenTomatoes.search(query, 0, 5, function(data) {
                callback(data);
                Persistence.persistSearch(query, data);
            });
        } else {
            RottenTomatoes.search(query, page, items, callback);
        }
    } else {
        callback({ search: [] });
    }
}