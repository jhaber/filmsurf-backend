var mongoose = require('mongoose');

console.log('Opening mongo connection to ' + process.env.MONGOLAB_URI);

mongoose.connect(process.env.MONGOLAB_URI);

mongoose.connection.addListener('open', function() {
    console.log('Mongo connection opened');
});

var Search = require('./search').search;
var Retrieve = require('./movie').retrieve;

exports.bind = function(router) {
    router.get('/search').bind(function (request, response, params) {
        Search(params, function (data) {
            response.send(200, {'Content-Type': 'application/json'}, data);
        });
    });

    router.get(/^movie\/(\w+)$/).bind(function (request, response, id, params) {
        Retrieve(id, params, function(data) {
            response.send(200, {'Content-Type': 'application/json'}, data);
        });
    });
}