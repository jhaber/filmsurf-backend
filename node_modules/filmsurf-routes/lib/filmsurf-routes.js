var Movies = require('./movies');

exports.bind = function(router) {
    router.get('/search', function (req, res) {
        Movies.search(req.query, function (data, expiration) {
            respond(res, data, expiration);
        });
    });

    router.get('/movie/:id', function (req, res) {
        var id = req.params.id;
        Movies.retrieve(id, function(data, expiration) {
            respond(res, data, expiration);
        });
    });
};

var respond = function(res, data, expiration) {
    if (expiration) {
        res.setHeader('Cache-Control', 'max-age=' + expiration + ', public');
    }
    if (data.error === true) {
        res.send(data.code);
    } else {
        res.json(200, data);
    }
};