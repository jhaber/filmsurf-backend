var Request = require('request');
var Q = require('q');

var host = 'http://imdbapi.org';
var basePath = '/';

var retrievePath = host + basePath;

exports.retrieve = function (id) {
    var deferred = Q.defer();

    var request = {};
    request.url = retrievePath;
    request.qs = { 'id': id };
    request.json = true;

    Request.get(request, function (err, response, body) {
        if (!err && response && response.statusCode === 200) {
            deferred.resolve(body);
        } else {
            if (err) {
                console.log('Error retrieving URL: ' + retrievePath + ', ' + err);
                deferred.reject(err);
            } else if (response) {
                console.log('Error retrieving URL: ' + retrievePath + ', ' + JSON.stringify(response));
                deferred.reject(response);
            } else {
                console.log('Error retrieving URL: ' + retrievePath);
                deferred.reject();
            }
        }
    });

    return deferred.promise;
};